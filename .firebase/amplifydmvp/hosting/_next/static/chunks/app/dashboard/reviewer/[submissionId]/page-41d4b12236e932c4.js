(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8373],{17599:(e,s,r)=>{Promise.resolve().then(r.bind(r,78875))},59576:(e,s,r)=>{"use strict";r.d(s,{A:()=>u,AuthProvider:()=>c});var t=r(95155),i=r(12115),a=r(93004),l=r(28214),n=r(45011),o=r(50172);let d=(0,i.createContext)(void 0),c=e=>{let{children:s}=e,[r,c]=(0,i.useState)(null),[u,m]=(0,i.useState)(null),[h,x]=(0,i.useState)(!0),[f,v]=(0,i.useState)(null);(0,i.useEffect)(()=>{let e=(0,a.hg)(l.j2,async e=>{if(m(e),e)try{let e=await (0,n.pD)();console.log("User info in AuthContext:",e),c(e),v(null)}catch(s){console.error("Error fetching user info from Firestore:",s);let e="Failed to load user profile.";s instanceof Error?e=s.message:"object"==typeof s&&null!==s&&"message"in s&&(e=s.message),v(e),c(null)}else c(null),v(null);x(!1)});return()=>e()},[]);let j=(null==r?void 0:r.role)==="admin",b=(null==r?void 0:r.role)==="reviewer",p=(null==r?void 0:r.role)==="uploader";return h?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsx)(o.A,{className:"w-10 h-10 animate-spin text-primary"})}):(0,t.jsx)(d.Provider,{value:{currentUser:r,loading:h,error:f,firebaseUser:u,isAdmin:j,isReviewer:b,isUploader:p},children:s})},u=()=>{let e=(0,i.useContext)(d);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},78875:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>y});var t=r(95155),i=r(12115),a=r(35695),l=r(59576),n=r(97326),o=r(23062),d=r(66695),c=r(50172),u=r(12543),m=r(98921),h=r(14347),x=r(9521),f=r(87481),v=r(10486),j=r(62177),b=r(90221),p=r(17759),N=r(30285),w=r(6874),g=r.n(w);function y(){let{submissionId:e}=(0,a.useParams)(),s=(0,a.useRouter)(),{currentUser:r,loading:w}=(0,l.A)(),{toast:y}=(0,f.dj)(),[S,k]=(0,i.useState)(null),[A,E]=(0,i.useState)(!0),[C,D]=(0,i.useState)(null),F=(0,j.mN)({resolver:(0,b.u)(o.Q3),defaultValues:{scores:{},overallScore:5,strengths:"",improvements:"",summary:"",audioFeedbackUrl:"",videoFeedbackUrl:""}});F.watch("overallScore"),(0,i.useEffect)(()=>{async function s(){if(!e){D("No submission ID provided."),E(!1);return}if(!r||"reviewer"!==r.role)return void E(!1);try{let s=await (0,n.hx)(e);s?s.reviewerId!==r.id?(D("You are not authorized to review this submission."),k(null)):k(s):D("Submission not found.")}catch(e){console.error("Error fetching submission:",e),D("Failed to load submission details.")}finally{E(!1)}}w||s()},[e,r,w]);let _=async e=>{if(S&&r)try{await (0,v.h6)({submissionId:S.id,reviewData:e,overallScore:e.overallScore}),y({title:"Review Submitted!",description:"Your review has been successfully recorded."}),s.push("/dashboard/reviewer")}catch(s){console.error("Error submitting review:",s);let e="An unknown error occurred.";s instanceof Error?e=s.message:"object"==typeof s&&null!==s&&"message"in s&&(e=s.message),y({title:"Error",description:e||"Failed to submit review.",variant:"destructive"})}};return w||A?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,t.jsx)(c.A,{className:"w-8 h-8 animate-spin text-primary"})}):C?(0,t.jsxs)("div",{className:"text-center py-20",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-destructive",children:"Error"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:C}),(0,t.jsx)(N.$,{asChild:!0,className:"mt-4",children:(0,t.jsx)(g(),{href:"/dashboard/reviewer",children:"Back to Dashboard"})})]}):S?(0,t.jsxs)("div",{className:"max-w-6xl mx-auto space-y-8 p-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(N.$,{variant:"outline",size:"sm",asChild:!0,children:(0,t.jsxs)(g(),{href:"/dashboard/reviewer",children:[(0,t.jsx)(u.A,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold font-headline",children:"Review Submission"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Provide your detailed feedback for this track."})]})]}),(0,t.jsxs)(d.Zp,{children:[(0,t.jsxs)(d.aR,{children:[(0,t.jsxs)(d.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(m.A,{className:"w-5 h-5"}),S.songTitle]}),(0,t.jsxs)(d.BT,{children:["by ",S.artistName]})]}),(0,t.jsxs)(d.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Genre"}),(0,t.jsx)("p",{className:"text-lg",children:S.genre})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Submitted"}),(0,t.jsx)("p",{className:"text-lg",children:new Date(S.submittedAt).toLocaleDateString()})]})]}),(0,t.jsx)(N.$,{asChild:!0,className:"w-full md:w-auto",children:(0,t.jsxs)("a",{href:S.songUrl,target:"_blank",rel:"noopener noreferrer",children:[(0,t.jsx)(h.A,{className:"w-5 h-5 mr-2"})," Listen to Track"]})})]})]}),(0,t.jsx)(p.lV,{...F,children:(0,t.jsxs)("form",{onSubmit:F.handleSubmit(_),className:"space-y-8",children:[(0,t.jsx)(x.A,{form:F,scores:F.watch()}),(0,t.jsxs)("div",{className:"flex gap-4 pt-6",children:[(0,t.jsx)(N.$,{type:"button",variant:"outline",onClick:()=>s.push("/dashboard/reviewer"),className:"flex-1",children:"Cancel"}),(0,t.jsx)(N.$,{type:"submit",className:"flex-1",disabled:F.formState.isSubmitting,children:F.formState.isSubmitting?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Submitting Review..."]}):"Submit Review"})]})]})})]}):(0,t.jsxs)("div",{className:"text-center py-20",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"Submission Not Found"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"The submission you are looking for does not exist or you do not have access."}),(0,t.jsx)(N.$,{asChild:!0,className:"mt-4",children:(0,t.jsx)(g(),{href:"/dashboard/reviewer",children:"Back to Dashboard"})})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[2992,3644,4277,555,6874,5594,9260,4103,4121,2320,5525,9521,8441,1684,7358],()=>s(17599)),_N_E=e.O()}]);